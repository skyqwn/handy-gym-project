"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,a=Array(e.length);n<e.length;n++)a[n]=e[n];return a}return Array.from(e)}var fileInput=document.querySelector("input[name=gymPhotos]"),preview=document.getElementById("preview"),fakeFileBtn=document.getElementById("fakeFileBtn"),originalPreviews=document.querySelectorAll(".originalPreview"),MAX_FILE=6,dataTransfer=new DataTransfer,generateRandomId=function(){return Math.random().toString(16).slice(2)},startLoading=function(e){e.innerHTML="",e.classList.contains("fa-pen")?(e.classList.remove("fa-pen"),e.classList.add("fa-spinner"),e.classList.add("fa-spin-pulse")):(e.innerHTML='<i class="fa-solid fa-spinner fa-spin-pulse"></i>',e.disabled=!0)},endLoading=function(e){e.innerHTML="",e.innerHTML='<i class="fa-solid fa-camera"></i>',e.disabled=!1},compressFile=async function(e){var n;try{if(!(dataTransfer.files.length>=MAX_FILE))return(n=await imageCompression(e,{maxSizeMB:1,maxWidthOrHeight:960,initialQuality:.8,useWebWorker:!1})).name=""+(e.name||"힙합"),convertBlobToFile(n)}catch(e){console.log(e),alert("파일 올리는 도중 오류발생")}},convertBlobToFile=function(e){return new File([e],e.name||"preview",{type:"images/*"})},generateBtns=function(n){var e=document.createElement("div"),a=(e.innerHTML='<i class="fa-solid fa-xmark"></i>',e.addEventListener("click",function(e){a(n)}),function(n){document.getElementById(n).remove();var e=[].concat(_toConsumableArray(dataTransfer.files)).findIndex(function(e){return e.id===n});dataTransfer.items.remove(e),fileInput.files=dataTransfer.files}),t=document.createElement("div"),i=(t.innerHTML='<i class="fa-solid fa-pen"></i>',t.addEventListener("click",function(e){i(n,e.target)}),function(n,a){var e=document.createElement("input");e.type="file",e.click(),e.addEventListener("change",function(e){return updateChange(e,n,a)})});return{deleteBtn:e,updateBtn:t}},paintUpdatePreview=function(e,n){var n=document.getElementById(n),a=(n.id=e.id,n.childNodes[0]),t=URL.createObjectURL(e),a=(a.src=t,n.childNodes[1]),t=(a.innerHTML="",generateBtns(e.id)),n=t.deleteBtn,e=t.updateBtn;a.append(e),a.append(n)},paintPreview=function(e,n){var a=document.createElement("div"),t=(a.id=n,document.createElement("div")),i=document.createElement("img"),r=URL.createObjectURL(e),e=(i.onload=function(){URL.revokeObjectURL(r)},i.src=r,a.classList.add("previewContainer"),a.classList.add("gymPreview"),i.classList.add("previewContainer__img"),t.classList.add("previewContainer__btn"),generateBtns(n)),n=e.deleteBtn,e=e.updateBtn;t.appendChild(e),t.appendChild(n),a.appendChild(i),a.appendChild(t),preview.append(a)},addChange=async function(e){var n=e.target.files;startLoading(fakeFileBtn);for(var a=0;a<n.length;a++){var t=generateRandomId(),i=await compressFile(n[a]);i&&(i.id=t,paintPreview(i,t),handleAddFile(i))}dataTransfer.files.length>=MAX_FILE&&alert("최대 "+MAX_FILE+"장까지 업로드 가능합니다"),endLoading(fakeFileBtn)},updateChange=async function(e,n,a){try{startLoading(a);var t=generateRandomId(),i=await compressFile(e.target.files[0]);i.id=t,handleUpdateFile(i,n)}catch(e){return console.log(e),void alert("파일 수정 도중 오류발생")}},handleAddFile=function(e){dataTransfer.items.add(e),fileInput.files=dataTransfer.files},handleUpdateFile=function(n,a){var e=Array.from(dataTransfer.files).map(function(e){return a===e.id?(paintUpdatePreview(n,e.id),n):e});dataTransfer.items.clear();for(var t=0;t<e.length;t++)dataTransfer.items.add(e[t]);fileInput.files=dataTransfer.files},init=function(){fileInput.addEventListener("change",addChange),fakeFileBtn.addEventListener("click",function(e){e.preventDefault(),fileInput.click()}),0<originalPreviews.length&&window.addEventListener("load",async function(){for(var e=0;e<originalPreviews.length;e++)await async function(e){var a=document.createElement("canvas");a.height=e.naturalHeight,a.width=e.naturalWidth,a.getContext("2d").drawImage(e,0,0);try{var n=await new Promise(function(n){return a.toBlob(function(e){return n(e)})}),t=convertBlobToFile(n),i=generateRandomId();t.id=i,paintPreview(t,i),handleAddFile(t)}catch(e){console.log(e),alert("미리보기 생성 중 오류발생")}}(originalPreviews[e])})};init();